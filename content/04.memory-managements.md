# Memory Management in Linux

## What is Memory?
- **Memory** (RAM) is a hardware component where **data** and **programs** are temporarily stored while the computer is running.
- RAM is **volatile**, meaning its contents are lost when the system powers off.
- Memory consists of **bytes**, each with a **unique address**, used to store data.
- If RAM is full, Linux uses **swap**, which is a portion of the hard drive acting as extra memory, but it is much slower.

## Main Linux Memory Commands

### 1. Quick Memory Overview
To quickly check how much RAM and swap we have and what’s in use:

```
free -h
```
>[!NOTE]
>`-h`: Human-readable output (e.g., MB, GB).

**Sample Output:**
```
              total        used        free      shared  buff/cache   available
Mem:           7.6G        2.1G        3.9G        183M        1.6G        5.0G
Swap:          2.0G         12M        2.0G
```
- **Mem**: Physical RAM statistics.
- **Swap**: Disk space used as "extra RAM".
- **total**: Installed RAM or swap.
- **used**: Memory currently in use.
- **free**: Completely unused memory.
- **shared**: Shared memory (e.g., tmpfs).
- **buff/cache**: Memory used for disk buffers and cache to speed up access to recently used data.
- **available**: Estimated memory available for new applications.



### 2. Live Memory and Process Monitoring
For a real-time view of how processes are using your memory:

- `top`: Interactive display of processes and memory usage.
- `htop`: Enhanced version of `top`, requires installation, with this command: `sudo apt install htop`.

>[!NOTE]
>To learn more about how to install packages in Ubuntu, [click here](https://documentation.ubuntu.com/server/how-to/software/package-management/).

```
top
```
**Sample Output (Top Lines):**
```
top - 14:22:45 up 15 min,  1 user,  load average: 0.62, 0.29, 0.14
Tasks: 208 total, 1 running, 203 sleeping, 0 stopped, 4 zombie
%Cpu(s): 7.3 us, 2.6 sy, 0.0 ni, 89.7 id, 0.2 wa, 0.0 hi, 0.3 si, 0.0 st
MiB Mem: 2987.5 total, 491.9 free, 1252.5 used, 1430.7 buff/cache
MiB Swap: 0.0 total, 0.0 free, 0.0 used. 1735.3 avail Mem
```
>[!IMPORTANT]
> Press **q** to quit.

**Header Information**

```
top - 14:22:45 up 15 min,  1 user,  load average: 0.62, 0.29, 0.14
```
- **top**: The command you ran.
- **14:22:45**: Current system time.
- **up 15 min**: System uptime (15 minutes since last boot).
- **1 user**: 1 user currently logged in.
- **load average**: 0.62, 0.29, 0.14: Average system load over the last 1, 5, and 15 minutes.

 **Task/Process Information**
```
Tasks: 208 total,   1 running, 203 sleeping,   0 stopped,   4 zombie
```
- **208 total**: Total number of processes.
- **1 running**: Number of actively running processes.
- **203 sleeping**: Number of idle/sleeping processes.
- **0 stopped**: No stopped processes.
- **4 zombie**: 4 zombie processes (these are "dead" processes whose parent hasn't collected their exit status)

**CPU Usage**
```
%Cpu(s):  7.3 us,  2.6 sy,  0.0 ni, 89.7 id,  0.2 wa,  0.0 hi,  0.3 si,  0.0 st
```
- **us**: User space CPU time (7.3%).
- **sy**: System/kernel CPU time (2.6%%).
- **ni**: User processes that have had their priority (niceness) manually changed (0.0%).
- **id**: Idle CPU (89.7%).
- **wa**: Waiting for I/O (0.2%).
- **hi**: Hardware interrupts (0.0%).
- **si**: Software interrupts (0.0%).
- **st**: Time stolen from this VM by hypervisor (0.0%).

**Memory Usage**
```
MiB Mem:   2987.5 total,   491.9 free,   1252.5 used,   1430.7 buff/cache
MiB Swap:   0.0 total,   0.0 free,     0.0 used.   1735.3 avail Mem
```
- **Physical RAM**:
  - **2,987.5 MiB total**: Total installed RAM.
  - **491.9 MiB free**: Unallocated RAM.
  - **1,252.5 MiB used**: Memory actually in use by processes.
  - **1,430.7 MiB buff/cache**: RAM used for buffers and cache (speeds up disk access).

- **Swap**:
  - **0.0 total**: No swap is configured
  - **0.0 used/free**: No swap available
  - **0.0 used**: Swap used.
  - **1,735.3 avail Mem**: Memory available for new applications


### 3. Detailed Memory Information
To display detailed information about system memory:
```
cat /proc/meminfo
```
**Sample Output (Top Lines):**
```
MemTotal:        3059196 kB
MemFree:          291056 kB
MemAvailable:    1730440 kB
Buffers:           57552 kB
Cached:          1518456 kB
```
- **MemTotal**: Total RAM.
- **MemFree**: Completely unused memory.
- **MemAvailable**: Estimated available memory.
- **Buffers**: Data in the memory waiting to be written to disk.
- **Cached**: Recently used files kept in RAM for fast access.


### 4. Check Which Programs Use the Most Memory
To find out which processes are using the most memory: 
```
ps aux --sort=-%mem | head
```
>[!NOTE]
> `%mem`: shows memory usage percentage.

**Sample Output (Top Lines):**
```
USER    PID   %CPU   %MEM    VSZ     RSS    TTY  STAT  START   TIME  COMMAND
dev    2226    0.8   14.9  4950336   456888  ?   Ssl   10:24   4:18   /usr/bin/gnome-shell
dev    3018    0.4   10.2  1830636   312588  ?   Sl    10:24   0:03   /usr/bin/ptyxis --gapplication-service
...
```
- **USER**: User running the process.
- **PID**: Process ID.
- **%MEM**: RAM usage.
- **VSZ**: Virtual memory size (KB).
- **RSS**(Resident Set Size): actual RAM the process is using (KB).
- **TTY**: Terminal type that the user is logged into (or ? if not associated with a terminal).
- **STAT**: Process status code.
- **START**: Start time of the process.
- **TIME**:	Total CPU time the process has used since it started (minutes:seconds).
- **COMMAND**: Command that started the process.


### 5. Memory Map of a Process
Show memory regions for a process:
```
pmap <pid>
```
>[!IMPORTANT]
> Replace `<pid>` with the process ID.
> For example, we run this command `pmap <2226>`.

**Sample Output (Top Lines):**
```
2226:   /usr/bin/gnome-shell
0000002b7699000    46k ----- [anon]
0000002b76a9000    52K r-x-- [anon]
0000002b76b6000    12k r-x-- [anon]
...
 total           4950320K
```
- Each line shows address, size, permissions, and mapping.
- **total**: Total process memory mapped.


### 6. Detailed Per-Process Memory Report
Reports memory usage per process, including shared memory
```
smem
```
>[!NOTE]
> You may need to install it first: `sudo apt install smem`

**Sample Output (Top Lines):**
```
PID   User     Command                                Swap   USS  PSS  RSS 
2226  dev     /usr/bin/gnome-shell 0                   0     48   136  1776 
3018  dev    /usr/bin/ptyxis --gapplication-service    0     92   179  1396 
...
```
- **PID**: Process ID.
- **User**: User running the process.
- **Command**: The command that started the process.
- **Swap**: Amount of swap space the process is using (in KB).
- **USS** (Unique Set Size): Memory uniquely used by this process.
- **PSS** (Proportional Set Size): Proportional share of shared memory plus unique memory. This is the most realistic measure for "how much RAM does this process really use?"
- **RSS**(Resident Set Size): actual RAM the process is using (in KB).


### 7. Monitor Memory Over Time
Reports memory, swap, I/O, and CPU stats:
```
vmstat 2 3
```
> Updates every 2 seconds, 3 times.

**Sample Output:**
```
procs -----------memory------------  ---swap--- -----io---- --system-- -------cpu-------
 r  b   swpd   free   buff  cache     si   so    bi    bo    in   cs     us  sy id  wa st
 8  0    0    230936 124356 1594372    0    0    104   38   1172  0      0  2  95  3  8
 1  0    0    230832 124356 1594372    0    0     0    8    4287  1678   5  2  93  0  1
 1  0    0    230832 124356 1594372    0    0     0    0    2594  861    3  1  96  0  1
```
- **procs**: Information about processes.
  - **r**: Number of processes running or ready to run.
  - **b**: Number of processes in uninterruptible sleep.
- **memory**: Information about swapping activity. 
  - **swpd**: Amount of virtual memory used (swap).
  - **free**: Idle memory.
  - **buff**: Memory used for buffers.
  - **cache**: Memory used for cache.
- **swap**: Swap space Statistics.
  - **si**: The rate of swapping-in memory from disk.
  - **so**: The rate of swapping-out memory to disk.
-**io**: Input/Output Statistics
  - **bi**: Blocks received from a block device per second.
  - **bo**: Blocks sent to a block device per second.
- **system**: System-level information.
  - **in**: Number of interrupts per second.
  - **cs**:Number of context switches per second.
- **CPU**: CPU utilization percentages.
  - **us, sy, id, wa**: CPU usage (user, system, idle, waiting).
  - **st**: Stolen time by virtual machine hypervisor (%).


### 8. Swap Usage Status
Check current swap status:
```
swapon -s
```
If swap is in use, you’ll see details here.

**Sample Output:**

```
Filename       Type        Size    Used    Priority
/dev/sda2     partition   2097148  12000       -2
```
- **Filename**: Name of swap device/file.
- **Type**: Type of swap (partition or file).
- **Size**: Total size (in KB).
- **Used**: Amount of swap in use (in KB).
- **Priority**: Priority for swap usage.
